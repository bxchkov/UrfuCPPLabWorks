/*
Лабораторная работа 8
Задание 4
Тема: Форматированный ввод-вывод, манипуляторы потоков и обработка ошибок ввода.
*/

#include <iostream>
#include <iomanip>   // Для манипуляторов (setw, setprecision, setfill)
#include <windows.h> // Для SetConsoleOutputCP

using namespace std;

void task4() {
    cout << "--- Демонстрация форматирования вывода ---" << endl;

    // 1. Установка точности для вещественных чисел
    double pi = 3.1415926535;
    cout << "Исходное число PI: " << pi << endl;

    // setprecision влияет на количество значащих цифр (или знаков после запятой в режиме fixed)
    cout << "Вывод с разной точностью (precision):" << endl;
    for(int i = 2; i <= 6; i++) {
        cout << "Precision " << i << ": " << setprecision(i) << pi << endl;
    }

    // 2. Форматирование таблиц (ширина поля и символ-заполнитель)
    cout << endl << "Таблица с выравниванием (setw) и заполнением (setfill):" << endl;

    // Заголовок таблицы
    cout << setfill('-'); // Устанавливаем символ-заполнитель '-'
    cout << "+" << setw(10) << "" << "+" << setw(15) << "" << "+" << endl; // Линия

    cout << setfill(' '); // Возвращаем пробел
    cout << "|" << setw(10) << "ID товара" << "|" << setw(15) << "Цена ($)" << "|" << endl;

    cout << setfill('-');
    cout << "+" << setw(10) << "" << "+" << setw(15) << "" << "+" << endl;

    // Данные
    cout << setfill(' ');
    cout << "|" << setw(10) << 101 << "|" << setw(15) << fixed << setprecision(2) << 150.50 << "|" << endl;
    cout << "|" << setw(10) << 25  << "|" << setw(15) << 10.00  << "|" << endl;
    cout << "|" << setw(10) << 3   << "|" << setw(15) << 999.99 << "|" << endl;

    cout << setfill('-');
    cout << "+" << setw(10) << "" << "+" << setw(15) << "" << "+" << endl;


    // 3. Обработка ошибок ввода (состояние потока)
    cout << endl << "--- Демонстрация обработки ошибок ввода ---" << endl;
    int val;
    cout << "Введите целое число (попробуйте ввести буквы, чтобы вызвать ошибку): ";
    cin >> val;

    // Проверка флага ошибки failbit
    if (cin.fail()) {
        cout << "ОШИБКА: Введено не число! Состояние потока: FAIL." << endl;

        // Сброс флагов ошибок, чтобы поток снова мог работать
        cin.clear();

        // Очистка буфера ввода (пропускаем все символы до конца строки)
        // Это нужно, чтобы "мусор", оставшийся в буфере, не мешал следующему вводу
        cin.ignore(32767, '\n');

        cout << "Поток восстановлен. Попробуйте ввести число еще раз: ";
        cin >> val;
        if (cin.good()) {
            cout << "Успешно! Вы ввели: " << val << endl;
        } else {
            cout << "Снова ошибка. Сдаюсь." << endl;
        }
    } else {
        cout << "Вы ввели: " << val << endl;
    }
}

int main() {
    SetConsoleOutputCP(CP_UTF8);
    task4();
    return 0;
}
